with a as(
select
  id_tipo_linea,
  tipo_linea,
  nv1,
  nv2,
  nv3,
  nv4,
  playas,
  dunas,
  sustrato,
  duna_anchura,
  duna_anc_indicador,
  acantilados,
  infraestructura_frente,
  infraestructura_2_linea,
  infraestructura_tipo,
  infraestructura_localizacion,
  infraestructura_exposicion,
  criterio,
  deslinde,
  tipo_margen,
  estacion,
  estacion_comentario,
  texto_wms,
  urbano,
  urbano_proximidad,
  tipo_toponimo_ssl,
  toponimo_ssl,
  fuente_toponimo_ssl,
  toponimo_sigla,
  toponimo_aeroguia,
  toponimo_carta_nautica,
  toponimo_ministerio,
  (st_dump(st_linemerge(st_collect(geom)))).geom as geom
from
  linea_costa_export.vw__complete_described
group by
  id_tipo_linea,
  tipo_linea,
  nv1,
  nv2,
  nv3,
  nv4,
  playas,
  dunas,
  sustrato,
  duna_anchura,
  duna_anc_indicador,
  acantilados,
  infraestructura_frente,
  infraestructura_2_linea,
  infraestructura_tipo,
  infraestructura_localizacion,
  infraestructura_exposicion,
  criterio,
  deslinde,
  tipo_margen,
  estacion,
  estacion_comentario,
  texto_wms,
  urbano,
  urbano_proximidad,
  tipo_toponimo_ssl,
  toponimo_ssl,
  fuente_toponimo_ssl,
  toponimo_sigla,
  toponimo_aeroguia,
  toponimo_carta_nautica,
  toponimo_ministerio)
select
  row_number() over (order by tipo_linea) as gid,
  id_tipo_linea,
  tipo_linea,
  nv1,
  nv2,
  nv3,
  nv4,
  playas,
  dunas,
  sustrato,
  duna_anchura,
  duna_anc_indicador,
  acantilados,
  infraestructura_frente,
  infraestructura_2_linea,
  infraestructura_tipo,
  infraestructura_localizacion,
  infraestructura_exposicion,
  criterio,
  deslinde,
  tipo_margen,
  estacion,
  estacion_comentario,
  texto_wms,
  urbano,
  urbano_proximidad,
  tipo_toponimo_ssl,
  toponimo_ssl,
  fuente_toponimo_ssl,
  toponimo_sigla,
  toponimo_aeroguia,
  toponimo_carta_nautica,
  toponimo_ministerio,
  st_length(geom) as length,
  geom
from
  a;
